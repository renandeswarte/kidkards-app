/*! app.js 2016-02-22 */
angular.module("myApp",["ngRoute","ngCookies","myApp.login","myApp.homepage","myApp.auth","myApp.authServices","myApp.categoriesServices","myApp.cookieServices","myApp.flashcardsServices","myApp.header","myApp.headerDirective","myApp.footer","myApp.footerDirective","myApp.modalDirective","myApp.addFlashcardPage","myApp.browseCategoriesPage","myApp.browseFlashcardsPage","myApp.quizzCategoriesPage","myApp.quizzFlashcardsPage","myApp.updateDeleteCard","myApp.matchingCategoriesPage","myApp.matchingFlashcardsPage"]).config(["$routeProvider",function(a){a.otherwise({redirectTo:"/"})}]);var productionURL="https://flashcardsapi.herokuapp.com",developmentURL="http://127.0.0.1:8000",apiURL=productionURL;angular.module("myApp.authServices",[]).factory("Auth",["$http","$cookies",function(a,b){var c=function(b){return a({method:"POST",url:apiURL+"/auth/user-login",data:{user:b}}).success(function(a){return a}).error(function(a){return console.log("error creation"),a})},d=function(b){return a({method:"POST",url:apiURL+"/auth/user-create",data:{user:b}}).success(function(a){return a}).error(function(a){return console.log("error creation"),a})},e=function(){return a({method:"GET",url:apiURL+"/auth/logout"}).then(function(a){return a.data})},f=function(){return!!b.get("flashcards-app-FC")};return{loginUser:c,createUser:d,logout:e,isAuth:f}}]),angular.module("myApp.categoriesServices",[]).factory("Categories",["$http",function(a){var b={},c=function(){return a({method:"GET",url:apiURL+"/categories/getList"}).then(function(a){for(var c in a.data)b[a.data[c].id]=a.data[c].name;return a.data})},d=function(b){return a({method:"POST",url:apiURL+"/categories/create",data:b}).success(function(a){}).error(function(a){console.log("error creation")})},e=function(){return b};return{getCategoriesList:c,getCategories:e,createCategory:d}}]),angular.module("myApp.cookieServices",[]).factory("Cookie",["$cookies",function(a){var b=function(a){var b=a.substring(a.indexOf("{"),a.lastIndexOf("}")+1);return angular.fromJson(b)};return{parseCookie:b}}]),angular.module("myApp.flashcardsServices",[]).factory("FlashCards",["$http",function(a){var b=function(){return a({method:"GET",url:apiURL+"/flashcard/getLastest"}).success(function(a){return a.data}).error(function(a){console.log("error creation")})},c=function(b){return a({method:"GET",url:apiURL+"/flashcard/"+b}).success(function(a){return a.data}).error(function(a){console.log("error getting flashcards")})},d=function(b){return a({method:"PUT",url:apiURL+"/flashcard/update-flashcard",data:{id:b.id,definition:b.definition}}).success(function(a){return a}).error(function(a){console.log("error getting flashcards")})},e=function(b){return a({method:"DELETE",url:apiURL+"/flashcard/delete-flashcard/"+b.id}).success(function(a){return a}).error(function(a){console.log("error deleting flashcards")})},f=function(a){var b=0,c=0,d=null;for(b=a.length-1;b>0;b-=1)c=Math.floor(Math.random()*(b+1)),d=a[b],a[b]=a[c],a[c]=d;return a},g=function(a,b){var c=new XMLHttpRequest;c.open("GET",apiURL+"/api/sign_s3?file_name="+b+"&file_type="+a.type),c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var b=JSON.parse(c.responseText);h(a,b.signed_request,b.url)}else alert("Could not get signed URL.")},c.send()},h=function(a,b,c){var d=new XMLHttpRequest;d.open("PUT",b),d.setRequestHeader("x-amz-acl","public-read"),d.onerror=function(){alert("Oops it looks like your picture was not uploaded properly")},d.send(a)};return{getLastestFlashcards:b,getFlashcardsByCategory:c,shuffleFlashcards:f,updateFlashcard:d,deleteFlashcard:e,signRequest:g}}]),angular.module("myApp.addFlashcardPage",["ngRoute"]).config(["$routeProvider",function(a){a.when("/add-flashcard",{authenticate:!0,templateUrl:"views/add-flashcard/add-flashcard.html",controller:"addFlashcard"})}]).controller("addFlashcard",["$scope","$http","FlashCards","Categories","$location",function(a,b,c,d,e){angular.element(".page").css("min-height",window.innerHeight-40+"px"),a.getCategories=function(){d.getCategoriesList().then(function(b){var c=[];for(var d in b)c.push(b[d].name);c.sort(),a.categories=c})},a.addNewCategory=function(a){var b=document.getElementById("category-list-"+a),c=document.createElement("option");c.text=angular.element("#add-new-category-"+a).val(),c.setAttribute("data-new",!0),b.add(c,b[0]),b.options[0].selected=!0},a.flashcard={},a.submitFc=function(){var c=angular.element("#fc-term-text"),f=angular.element("#fc-definition-img"),g=angular.element("#fc-definition-text"),h=angular.element("#category-list-img").val(),i=angular.element("#category-list-text").val(),j={};if(a.ImgOrText?(j.term=c.val(),j.picture=null,j.definition=g.val(),j.categoryName=i,j.img=!1,c.required=!0):(j.term=null,j.picture=a.flashcard.picture,j.definition=f.val(),j.categoryName=h,j.img=!0,c.required=!1),j.img){if($("#category-list-img option:selected").data("new")){var k={name:$("#category-list-img option:selected").val()};d.createCategory(k)}}else if($("#category-list-text option:selected").data("new")){var l={name:$("#category-list-text option:selected").val()};d.createCategory(l)}return b({method:"POST",url:apiURL+"/flashcard/create",data:{flashCard:j}}).success(function(a){c.val(""),f.val(""),g.val(""),angular.element("#file_input").val(""),e.path("/homepage")}).error(function(a){console.log("error creation")})};var f=function(){return Math.random().toString(36).substr(2,15)};a.submitPicture=function(){var b=f();c.signRequest(a.flashcardPicture,b),a.flashcard.picture="https://flashcards-app.s3.amazonaws.com/pictures/"+b},a.$watch("flashcardPicture",function(){a.flashcardPicture&&a.flashcardPicture.size<5242880&&a.submitPicture()})}]).directive("filereadupload",[function(){return{scope:{filereadupload:"="},link:function(a,b,c){b.bind("change",function(b){a.$apply(function(){a.filereadupload=b.target.files[0]})})}}}]),angular.module("myApp.auth",[]).controller("AuthController",["$scope","$route","$http","Auth","$cookies","$location","Cookie","$window","$rootScope",function(a,b,c,d,e,f,g,h,i){a.user=null;var j=e.get("flashcards-app-FC");if(j){var k=g.parseCookie(j),l={uid:k.uid,username:k.username,email:k.email,isAdmin:k.isAdmin,token:k.token};a.user=l}i.$on("unAuth",function(b){a.user=null}),a.login=function(){var b={userEmail:angular.element("#login-email").val(),userPwd:angular.element("#login-password").val()};d.loginUser(b).then(function(a){console.log(a.data),e.put("flashcards-app-FC",JSON.stringify(a.data)),h.location.href="/"})["catch"](function(b){console.log("error",b),a.error={message:b.data.code}})},a.logout=function(){e.remove("flashcards-app-FC"),h.location.href="/"},a.createUser=function(){var b={userName:angular.element("#signup-firstname").val(),userEmail:angular.element("#signup-email").val(),userPwd:angular.element("#signup-password").val()};d.createUser(b).then(function(a){h.location.href="/"})["catch"](function(b){console.log("error",b),a.error={message:b.data.code}})}}]),angular.module("myApp.browseCategoriesPage",["ngRoute"]).config(["$routeProvider",function(a){a.when("/categories",{authenticate:!0,templateUrl:"views/browse-categories/browse-categories.html",controller:"showCategories"})}]).controller("showCategories",["$scope","$http","FlashCards","Categories",function(a,b,c,d){angular.element(".page").css("min-height",window.innerHeight-40+"px"),a.getCategories=function(){d.getCategoriesList().then(function(b){var c=[];for(var d in b)c.push(b[d]);c.sort(function(a,b){return a.name.localeCompare(b.name)}),a.categories=c,angular.element("#loader").remove()})}}]),angular.module("myApp.browseFlashcardsPage",["ngRoute"]).config(["$routeProvider",function(a){a.when("/categories/:category",{authenticate:!0,templateUrl:"views/browse-flashcards/browse-flashcards.html",controller:"browseFlashcards"})}]).controller("browseFlashcards",["$scope","$route","FlashCards",function(a,b,c){angular.element(".page").css("min-height",window.innerHeight-40+"px"),a.category=b.current.params.category,c.getFlashcardsByCategory(b.current.params.category).then(function(b){a.flashcards=b.data,angular.element("#loader").remove()});var d,e=70;a.expand=function(a){if(d=d||angular.element(a.currentTarget).height(),document.body.clientWidth<480){angular.element(a.currentTarget).toggleClass("expanded");var b=angular.element(a.currentTarget).height(),c=angular.element(a.currentTarget).offset();c.left>0?(angular.element(a.currentTarget).addClass("right-element-expanded"),$("html, body").animate({scrollTop:c.top+b-e},500)):angular.element(a.currentTarget).hasClass("right-element-expanded")&&(angular.element(a.currentTarget).removeClass("right-element-expanded"),$("html, body").animate({scrollTop:c.top-d-e},500))}}}]),angular.module("myApp.footerDirective",[]).directive("footerDirective",function(){return{templateUrl:"views/footer/footer.html"}}),angular.module("myApp.footer",[]).controller("footerController",["$scope",function(a){}]),angular.module("myApp.headerDirective",[]).directive("headerDirective",function(){return{templateUrl:"views/header/header.html"}}).directive("bsActiveLink",["$location",function(a){return{restrict:"A",replace:!1,link:function(b,c){b.$on("$routeChangeSuccess",function(){var b=["/#"+a.path(),"#"+a.path(),a.path()];angular.forEach(c.find("a"),function(a){a=angular.element(a),-1!==b.indexOf(a.attr("href"))?a.parent().addClass("active"):a.parent().removeClass("active")})})}}}]),angular.module("myApp.header",[]).controller("headerController",["$scope","$log","$location","$window",function(a,b,c,d){a.showLoginModal=function(){angular.element("#login-modal").modal("show")},a.logout=function(){d.location.href="/auth/logout"}}]),angular.module("myApp.homepage",["ngRoute"]).config(["$routeProvider",function(a){a.when("/",{authenticate:!0,templateUrl:"views/home/home.html",controller:"homepage"})}]).controller("homepage",["$scope","$http","Categories","FlashCards",function(a,b,c,d){angular.element(".page").css("min-height",window.innerHeight-40+"px")}]),angular.module("myApp.login",["ngRoute"]).config(["$routeProvider",function(a){a.when("/login",{authenticate:!1,templateUrl:"views/login/login.html"})}]),angular.module("myApp.matchingCategoriesPage",["ngRoute"]).config(["$routeProvider",function(a){a.when("/matching-categories",{authenticate:!0,templateUrl:"views/matching-categories/matching-categories.html",controller:"showMatchingCategories"})}]).controller("showMatchingCategories",["$scope","$http","FlashCards","Categories",function(a,b,c,d){angular.element(".page").css("min-height",window.innerHeight-40+"px"),window.onresize=function(a){angular.element(".page").css("min-height",window.innerHeight-40+"px")},a.getCategories=function(){d.getCategoriesList().then(function(b){var c=[];for(var d in b)c.push(b[d]);c.sort(function(a,b){return a.name.localeCompare(b.name)}),a.categories=c,angular.element("#loader").remove()})}}]),angular.module("myApp.matchingFlashcardsPage",["ngRoute"]).config(["$routeProvider",function(a){a.when("/matching-category/:category",{authenticate:!0,templateUrl:"views/matching-flashcards/matching-flashcards.html",controller:"matchingCategory"})}]).controller("matchingCategory",["$scope","$route","FlashCards","$timeout",function(a,b,c,d){function e(a){var b,c,d=parseInt(a/1e3);return 10>d?timeSpent="0"+d+" seconds":d>=10&&60>d?timeSpent=d+" seconds":(b=parseInt(d/60),b=1===b?b+"minute":b+"minutes",c=d%60===0?"":" and "+d%60+" seconds",timeSpent=b+c),timeSpent}angular.element(".page").css("min-height",window.innerHeight-40+"px"),a.category=b.current.params.category;var f,g,h,i=0,j=0,k=null,l=null,m=null,n=null,o=!1;a.getFlashCard=function(d){angular.element("#loader").removeClass("hidden"),angular.element(".setting-container").addClass("hidden"),c.getFlashcardsByCategory(b.current.params.category).then(function(b){var e=b.data;flashcardsList=[];for(var g in e){var h={};h[g]=e[g],flashcardsList.push(h)}c.shuffleFlashcards(flashcardsList);for(var j=[],k=0;d/2>k;k++)j.push(flashcardsList[k]);for(var l=[],m=0;m<j.length;m++)for(var n in j[m]){var o={},p={};j[m][n].isImg?(o.isMain=!0,o.isImg=!0,o.picture=j[m][n].picture,o.id=n,p.isMain=!1,p.definition=j[m][n].definition,p.id=n):(o.isMain=!0,o.isImg=!1,o.term=j[m][n].term,o.id=n,p.isMain=!1,p.definition=j[m][n].definition,p.id=n),l.push(o,p)}c.shuffleFlashcards(l),a.flashcards=l,i=l.length,angular.element("#loader").remove(),angular.element(".flashcards-container").removeClass("hidden");var q=new Date;f=q.getTime()})},a.selected=function(a){if(!o){var b=angular.element('.flip-container[data-cardid="'+a.id+'"][data-cardmain="'+a.isMain+'"]');if(b.addClass("flipped"),k?(m=b,n=a.id):(k=b,l=a.id),j++,2===j){if(k.data("cardmain")===m.data("cardmain")&&l===n)return k.removeClass("flipped"),j=0,k=null,void(m=null);o=!0,d(function(){if(l===n){if(k.css({opacity:"0"}),m.css({opacity:"0"}),i-=2,0===i){angular.element(".replay-container").removeClass("hidden"),angular.element("flashcards-container").addClass("hidden");var a=new Date;g=a.getTime(),h=e(g-f),angular.element("#time-spent").html(h)}}else k.removeClass("flipped"),m.removeClass("flipped");j=0,k=null,m=null,o=!1},700)}}},a.reload=function(){b.reload()}}]),angular.module("myApp.modalDirective",[]).directive("modalDirective",function(){return{templateUrl:"views/modal/modal.html"}}),angular.module("myApp.quizzCategoriesPage",["ngRoute"]).config(["$routeProvider",function(a){a.when("/quizz-categories",{authenticate:!0,templateUrl:"views/quizz-categories/quizz-categories.html",controller:"quizzShowCategories"})}]).controller("quizzShowCategories",["$scope","$http","FlashCards","Categories",function(a,b,c,d){angular.element(".page").css("min-height",window.innerHeight-40+"px"),a.getCategories=function(){d.getCategoriesList().then(function(b){var c=[];for(var d in b)c.push(b[d]);c.sort(function(a,b){return a.name.localeCompare(b.name)}),a.categories=c,angular.element("#loader").remove()})}}]),angular.module("myApp.quizzFlashcardsPage",["ngRoute"]).config(["$routeProvider",function(a){a.when("/quizz-categories/:category",{authenticate:!0,templateUrl:"views/quizz-flashcards/quizz-flashcards.html",controller:"quizzCategory"})}]).controller("quizzCategory",["$scope","$route","FlashCards",function(a,b,c){angular.element(".page").css("min-height",window.innerHeight-40+"px"),a.category=b.current.params.category;var d,e,f=!1;a.flashcard,a.cardNumber,a.cardsTotal,a.sound=!1,a.initMatching=function(){c.getFlashcardsByCategory(b.current.params.category).then(function(b){d=b.data,e=[];for(var f in d)e.push(f);c.shuffleFlashcards(e),a.cardNumber=0,a.cardsTotal=e.length-1;var h=d[e[a.cardNumber]].isImg?!0:!1;a.flashcard=d[e[a.cardNumber]],angular.element(".btn.previous").addClass("greyed"),a.cardNumber===a.cardsTotal&&(angular.element(".btn.next").addClass("greyed"),angular.element(".no-more-cards").removeClass("hide")),g(h),angular.element("#loader").remove(),angular.element(".flashcard-container").show(),angular.element(".how-to").show(),angular.element(".sound-control").show()})};var g=function(a){a?(angular.element(".front .picture-container").addClass("displayed"),angular.element(".front .term-container").removeClass("displayed")):(angular.element(".front .picture-container").removeClass("displayed"),angular.element(".front .term-container").addClass("displayed"))};a.nextCard=function(){f||(f=!0,angular.element(".card-definition").hide(0).fadeIn(800,function(){f=!1})),angular.element(".flip-container").removeClass("flipped"),a.cardNumber<a.cardsTotal?(a.flashcard=d[e[++a.cardNumber]],isImg=d[e[a.cardNumber]].isImg?!0:!1,g(isImg),angular.element(".btn.previous").removeClass("greyed"),a.cardNumber===a.cardsTotal&&(angular.element(".btn.next").addClass("greyed"),angular.element(".no-more-cards").removeClass("hide"))):(angular.element(".btn.next").addClass("greyed"),angular.element(".no-more-cards").removeClass("hide"))},a.previousCard=function(){f||(f=!0,angular.element(".card-definition").hide(0).fadeIn(800,function(){f=!1})),angular.element(".flip-container").removeClass("flipped"),a.cardNumber>0?(a.flashcard=d[e[--a.cardNumber]],isImg=d[e[a.cardNumber]].isImg?!0:!1,g(isImg),0===a.cardNumber&&angular.element(".btn.previous").addClass("greyed"),a.cardNumber===a.cardsTotal-1&&(angular.element(".no-more-cards").addClass("hide"),angular.element(".btn.next").removeClass("greyed"))):angular.element(".btn.previous").addClass("greyed")},a.toggleSound=function(){a.sound=!a.sound},a.sayCardContent=function(b){angular.element(".flip-container").hasClass("flipped")&&a.sound&&responsiveVoice.speak(b)}}]).directive("backImg",function(){return function(a,b,c){c.$observe("backImg",function(a){b.css({background:"url("+a+")","background-repeat":"no-repeat","background-size":"cover","background-position":"50% 50%"})})}}),angular.module("myApp.updateDeleteCard",[]).controller("updateDeleteController",["$scope","$route","Cookie","$cookies","FlashCards",function(a,b,c,d,e){a.user=null;var f=d.get("flashcards-app-FC");if(f){var g=c.parseCookie(f),h={uid:g.uid,username:g.username,email:g.email,isAdmin:g.isAdmin,token:g.token};a.user=h}a.showUpdateModal=function(b,c){angular.element("#update-modal").modal("show"),a.definitionUpdate=c.value.definition,angular.element(".card-id").val(b),angular.element("#fc-definition-update").val(a.definitionUpdate)},a.showDeleteModal=function(a){angular.element("#delete-modal").modal("show"),angular.element(".card-id-delete").val(a)},a.updateForm=function(){var a={id:angular.element(".card-id").val(),definition:angular.element("#fc-definition-update").val()};e.updateFlashcard(a).then(function(a){angular.element("#update-modal").modal("hide"),b.reload()})},a.deleteForm=function(){var a={id:angular.element(".card-id-delete").val()};e.deleteFlashcard(a).then(function(a){angular.element("#delete-modal").modal("hide"),b.reload()})}}]);